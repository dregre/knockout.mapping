/// Knockout Mapping plugin v2.4.1
/// (c) 2013 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
/// License: MIT (http://www.opensource.org/licenses/mit-license.php)
(function(e){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?e(require("knockout"),exports):"function"===typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})})(function(e,f){function S(){for(var b=arguments,c=b.length,a={},d=[],e,f,n;c--;)for(n=b[c],e=n.length;e--;)f=n[e],a[f]||(a[f]=1,d.push(f));return d}function z(b,c){var a,d;for(d in c)c.hasOwnProperty(d)&&c[d]&&(a=f.getType(b[d]),d&&b[d]&&"array"!==a&&"string"!==a?z(b[d],c[d]):"array"===
f.getType(b[d])&&"array"===f.getType(c[d])?b[d]=S(b[d],c[d]):b[d]=c[d])}function G(b,c){var a={};z(a,b);z(a,c);return a}function A(b,c){for(var a=G({},b),d=L.length-1;0<=d;d--){var e=L[d];a[e]&&(a[""]instanceof Object||(a[""]={}),a[""][e]=a[e],delete a[e])}c&&(a.ignore=l(c.ignore,a.ignore),a.include=l(c.include,a.include),a.copy=l(c.copy,a.copy),a.observe=l(c.observe,a.observe));a.ignore=l(a.ignore,h.ignore);a.include=l(a.include,h.include);a.copy=l(a.copy,h.copy);a.observe=l(a.observe,h.observe);
a.mappedProperties=a.mappedProperties||{};a.copiedProperties=a.copiedProperties||{};return a}function l(b,c){"array"!==f.getType(b)&&(b="undefined"===f.getType(b)?[]:[b]);"array"!==f.getType(c)&&(c="undefined"===f.getType(c)?[]:[c]);return e.utils.arrayGetDistinctValues(b.concat(c))}function T(b,c){var a=e.dependentObservable;e.dependentObservable=function(a,c,d){d=d||{};a&&"object"==typeof a&&(d=a);var f=d.deferEvaluation,k=!1,p=function(a){var c=e.dependentObservable;e.dependentObservable=u;var d=
e.isWriteableObservable(a);e.dependentObservable=c;c=u({read:function(){k||(e.utils.arrayRemoveItem(b,a),k=!0);return a.apply(a,arguments)},write:d&&function(b){return a(b)},deferEvaluation:!0});c.__DO=a;return c};d.deferEvaluation=!0;a=new u(a,c,d);f||(a=p(a),b.push(a));return a};e.dependentObservable.fn=u.fn;e.computed=e.dependentObservable;var d=c();e.dependentObservable=a;e.computed=e.dependentObservable;return d}function H(b,c,a,d,g,D,n){var h="array"===f.getType(e.utils.unwrapObservable(c));
D=D||"";if(f.isMapped(b)){var k=e.utils.unwrapObservable(b).__ko_mapping__;a=G(k,a)}var p=n||g,l=function(){return a[d]&&a[d].create instanceof Function},w=function(b){return T(I,function(){return e.utils.unwrapObservable(g)instanceof Array?a[d].create({data:b||c,parent:p,skip:M}):a[d].create({data:b||c,parent:p})})},v=function(){return a[d]&&a[d].update instanceof Function},x=function(b,f){var g={data:f||c,parent:p,target:e.utils.unwrapObservable(b)};e.isWriteableObservable(b)&&(g.observable=b);
return a[d].update(g)};if(n=J.get(c))return n;d=d||"";if(h){var h=[],t=!1,m=function(a){return a};a[d]&&a[d].key&&(m=a[d].key,t=!0);e.isObservable(b)||(b=e.observableArray([]),b.mappedRemove=function(a){var c="function"==typeof a?a:function(b){return b===m(a)};return b.remove(function(a){return c(m(a))})},b.mappedRemoveAll=function(a){var c=E(a,m);return b.remove(function(a){return-1!=e.utils.arrayIndexOf(c,m(a))})},b.mappedDestroy=function(a){var c="function"==typeof a?a:function(b){return b===m(a)};
return b.destroy(function(a){return c(m(a))})},b.mappedDestroyAll=function(a){var c=E(a,m);return b.destroy(function(a){return-1!=e.utils.arrayIndexOf(c,m(a))})},b.mappedIndexOf=function(a){var c=E(b(),m);a=m(a);return e.utils.arrayIndexOf(c,a)},b.mappedGet=function(a){return b()[b.mappedIndexOf(a)]},b.mappedCreate=function(a){if(-1!==b.mappedIndexOf(a))throw Error("There already is an object with the key that you specified.");var c=l()?w(a):a;v()&&(a=x(c,a),e.isWriteableObservable(c)?c(a):c=a);b.push(c);
return c});n=E(e.utils.unwrapObservable(b),m).sort();k=E(c,m);t&&k.sort();t=e.utils.compareArrays(n,k);n={};var u,B=e.utils.unwrapObservable(c),z={},A=!0,k=0;for(u=B.length;k<u;k++){var r=m(B[k]);if(void 0===r||r instanceof Object){A=!1;break}z[r]=B[k]}var B=[],C=0,k=0;for(u=t.length;k<u;k++){var r=t[k],q,y=D+"["+k+"]";switch(r.status){case "added":var F=A?z[r.value]:K(e.utils.unwrapObservable(c),r.value,m);q=H(void 0,F,a,d,b,y,g);l()||(q=e.utils.unwrapObservable(q));y=N(e.utils.unwrapObservable(c),
F,n);q===M?C++:B[y-C]=q;n[y]=!0;break;case "retained":F=A?z[r.value]:K(e.utils.unwrapObservable(c),r.value,m);q=K(b,r.value,m);H(q,F,a,d,b,y,g);y=N(e.utils.unwrapObservable(c),F,n);B[y]=q;n[y]=!0;break;case "deleted":q=K(b,r.value,m)}h.push({event:r.status,item:q})}b(B);a[d]&&a[d].arrayChanged&&e.utils.arrayForEach(h,function(b){a[d].arrayChanged(b.event,b.item)})}else if(O(c)){b=e.utils.unwrapObservable(b);if(!b){if(l())return t=w(),v()&&(t=x(t)),t;if(v())return x(t);b={}}v()&&(b=x(b));J.save(c,
b);if(v())return b;P(c,function(d){var f=D.length?D+"."+d:d;if(-1==e.utils.arrayIndexOf(a.ignore,f))if(-1!=e.utils.arrayIndexOf(a.copy,f))b[d]=c[d];else if("object"!=typeof c[d]&&"array"!=typeof c[d]&&0<a.observe.length&&-1==e.utils.arrayIndexOf(a.observe,f))b[d]=c[d],a.copiedProperties[f]=!0;else{var g=J.get(c[d]),n=H(b[d],c[d],a,d,b,f,b),g=g||n;if(0<a.observe.length&&-1==e.utils.arrayIndexOf(a.observe,f))b[d]=e.utils.unwrapObservable(g),a.copiedProperties[f]=!0;else{if(e.isWriteableObservable(b[d])){if(g=
e.utils.unwrapObservable(g),b[d]()!==g)b[d](g)}else g=void 0===b[d]?g:e.utils.unwrapObservable(g),b[d]=g;a.mappedProperties[f]=!0}}})}else switch(f.getType(c)){case "function":v()?e.isWriteableObservable(c)?(c(x(c)),b=c):b=x(c):b=c;break;default:if(e.isWriteableObservable(b))return q=v()?x(b):e.utils.unwrapObservable(c),b(q),q;l()||v();b=l()?w():e.observable(e.utils.unwrapObservable(c));v()&&b(x(b))}return b}function N(b,c,a){for(var d=0,e=b.length;d<e;d++)if(!0!==a[d]&&b[d]===c)return d;return null}
function Q(b,c){var a;c&&(a=c(b));"undefined"===f.getType(a)&&(a=b);return e.utils.unwrapObservable(a)}function K(b,c,a){b=e.utils.unwrapObservable(b);for(var d=0,f=b.length;d<f;d++){var h=b[d];if(Q(h,a)===c)return h}throw Error("When calling ko.update*, the key '"+c+"' was not found!");}function E(b,c){return e.utils.arrayMap(e.utils.unwrapObservable(b),function(a){return c?Q(a,c):a})}function P(b,c){if("array"===f.getType(b))for(var a=0;a<b.length;a++)c(a);else for(a in b)c(a)}function O(b){var c=
f.getType(b);return("object"===c||"array"===c)&&null!==b}function U(){var b=[],c=[];this.save=function(a,d){var f=e.utils.arrayIndexOf(b,a);0<=f?c[f]=d:(b.push(a),c.push(d))};this.get=function(a){a=e.utils.arrayIndexOf(b,a);return 0<=a?c[a]:void 0}}function R(){var b={},c=function(a){var c;try{c={__ko_mapping_key__:a}}catch(e){c={__ko_mapping_key__:"$$$"}}a=b[c];void 0===a&&(a=new U,b[c]=a);return a};this.save=function(a,b){c(a).save(a,b)};this.get=function(a){return c(a).get(a)}}var u=e.dependentObservable,
C=0,I,J,L=["create","update","key","arrayChanged"],M={},w={include:["_destroy"],ignore:[],copy:[],observe:[]},h=w;f.isMapped=function(b){return(b=e.utils.unwrapObservable(b))&&b.__ko_mapping__};f.fromJS=function(b){if(0==arguments.length)throw Error("When calling ko.fromJS, pass the object you want to convert.");try{C++||(I=[],J=new R);var c,a;2==arguments.length&&(arguments[1].__ko_mapping__?a=arguments[1]:c=arguments[1]);3==arguments.length&&(c=arguments[1],a=arguments[2]);a&&(c=G(c,a.__ko_mapping__));
c=A(c);var d=H(a,b,c);a&&(d=a);if(!--C)for(;I.length;){var e=I.pop();e&&(e(),e.__DO.throttleEvaluation=e.throttleEvaluation)}d.__ko_mapping__=G(d.__ko_mapping__,c);return d}catch(f){throw C=0,f;}};f.fromJSON=function(b){var c=e.utils.parseJson(b);arguments[0]=c;return f.fromJS.apply(this,arguments)};f.updateFromJS=function(b){throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");};f.updateFromJSON=function(b){throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");
};f.toJS=function(b,c){h||f.resetDefaultOptions();if(0==arguments.length)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==f.getType(h.ignore))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==f.getType(h.include))throw Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==f.getType(h.copy))throw Error("ko.mapping.defaultOptions().copy should be an array.");c=A(c,b.__ko_mapping__);return f.visitModel(b,
function(a){return e.utils.unwrapObservable(a)},c)};f.toJSON=function(b,c){var a=f.toJS(b,c);return e.utils.stringifyJson(a)};f.defaultOptions=function(){if(0<arguments.length)h=arguments[0];else return h};f.resetDefaultOptions=function(){h={include:w.include.slice(0),ignore:w.ignore.slice(0),copy:w.copy.slice(0),observe:w.observe.slice(0)}};f.getType=function(b){if(b&&"object"===typeof b){if(b.constructor===Date)return"date";if(b.constructor===Array)return"array"}return typeof b};f.visitModel=function(b,
c,a){a=a||{};a.visitedObjects=a.visitedObjects||new R;var d,g=e.utils.unwrapObservable(b);if(O(g))a=A(a,g.__ko_mapping__),c(b,a.parentName),d="array"===f.getType(g)?[]:{};else return c(b,a.parentName);a.visitedObjects.save(b,d);var h=a.parentName;P(g,function(b){if(!a.ignore||-1==e.utils.arrayIndexOf(a.ignore,b)){var l=g[b],k=a,p=h||"";"array"===f.getType(g)?h&&(p+="["+b+"]"):(h&&(p+="."),p+=b);k.parentName=p;if(-1!==e.utils.arrayIndexOf(a.copy,b)||-1!==e.utils.arrayIndexOf(a.include,b)||!g.__ko_mapping__||
!g.__ko_mapping__.mappedProperties||g.__ko_mapping__.mappedProperties[b]||!g.__ko_mapping__.copiedProperties||g.__ko_mapping__.copiedProperties[b]||"array"===f.getType(g))switch(f.getType(e.utils.unwrapObservable(l))){case "object":case "array":case "undefined":k=a.visitedObjects.get(l);d[b]="undefined"!==f.getType(k)?k:f.visitModel(l,c,a);break;default:d[b]=c(l,a.parentName)}}});return d}});
